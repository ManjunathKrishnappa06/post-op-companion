<!-- 1. The Dialogflow Messenger Library -->
<script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>

<!-- 2. The Dialogflow Messenger Element -->
<df-messenger
  project-id="manjunath-vertex-ai"
  agent-id="33519cdf-cd2e-417c-9fa4-de5482015ec5"
  language-code="en"
</df-messenger>

<!-- 3. Our Custom Geolocation Script -->
<script>
  // Wait for the Dialogflow Messenger element to be ready
  document.addEventListener('df-messenger-loaded', function (event) {
    const dfMessenger = document.querySelector('df-messenger');

    // Listen for the chat window to be opened by the user
    dfMessenger.addEventListener('df-chat-opened', function (event) {
      console.log("Chat opened. Attempting to get location...");

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            console.log(`Location obtained: ${lat}, ${lng}`);

            // Send location to Dialogflow as session parameters
            dfMessenger.setSessionParameters({
              latitude: lat,
              longitude: lng
            });
          },
          (error) => {
            console.error("Geolocation error: ", error.message);
            dfMessenger.setSessionParameters({ location_permission: 'denied' });
          }
        );
      } else {
        console.log("Geolocation is not supported by this browser.");
        dfMessenger.setSessionParameters({ location_permission: 'unsupported' });
      }
    });
  });
</script>
